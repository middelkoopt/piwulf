{{- nobackup }}
{{- range $node := .AllNodes }}
{{- $cmdline := print "cmdline-" .Tags.Serial ".txt" }}
{{- $netdev := .NetDevs.default }}
{{- $baseuri := "" }}
{{- if $.Ipaddr6 }}
{{- $baseuri = print "http://[" $.Ipaddr6 "]:" $.Warewulf.Port "/provision/" .NetDevs.default.Hwaddr }}
{{- else }}
{{- $baseuri = print "http://" $.Ipaddr ":" $.Warewulf.Port "/provision/" .NetDevs.default.Hwaddr }}
{{- end }}
{{- file $cmdline }}
rd.shell rd.neednet=1 root=wwinit:{{default "tmpfs" .Root}} wwinit.uri={{ $baseuri }} init=/warewulf/run-init wwid={{$netdev.Hwaddr}} {{ .Kernel.Args | join " " }}
{{ end -}}
